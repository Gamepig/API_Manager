# PM2 API 管理頁面規劃書

## 1. 專案目標

建立一個基於 Python 的 GUI 應用程式，用於透過 PM2 管理所有專案的 API 服務。此應用程式應提供 API 列表、詳細資訊、狀態顯示、控制功能，並將 PM2 數據圖形化。該專案將作為未來大型專案的功能模組，因此需具備高度模組化、可重複使用與共用的特性。

## 2. 核心功能

### 2.1 API 列表 (依專案分類)
* 顯示所有透過 PM2 啟動的 API 服務列表。
* API 列表應依據「專案」進行分類展示，不對專案本身進行管理。
* 每個 API 項目需顯示其名稱、所屬專案、目前狀態。

### 2.2 API 詳細資訊與數據
* 點擊任一 API 可查看其詳細資訊，包含：
    * PM2 Process ID (PID)
    * 記憶體使用量
    * CPU 使用率
    * 運行時間 (Uptime)
    * 重啟次數 (Restarts)
    * 日誌路徑 (Log Path)
    * 專案路徑
* 數據圖形化：顯示歷史 CPU 和記憶體使用率趨勢圖。

### 2.3 API 狀態顯示
* 以直觀的燈號形式顯示 API 狀態：
    * 運行中：綠燈
    * 已停止：紅燈
    * 有問題 (例如：崩潰重啟中)：黃燈

### 2.4 API 控制
* 單獨 API 控制：
    * 啟動 (Start)
    * 重啟 (Restart)
    * 停止 (Stop)
* 專案層級控制：
    * 一鍵啟動某專案下所有 API 服務
    * 一鍵重啟某專案下所有 API 服務
    * 一鍵停止某專案下所有 API 服務

## 3. 技術選型

### 3.1 後端 (Backend)
* **Python 版本：** Python 3.9+
* **PM2 互動：** 使用 `subprocess` 模組執行 PM2 CLI 命令，或尋找成熟的 Python PM2 庫 (若有)。
* **數據處理：** 對 PM2 輸出的 JSON 數據進行解析和處理。
* **API 接口：** 提供簡單的 RESTful API 或直接使用內部函數調用，確保前後端分離和模組化。

### 3.2 前端 (Frontend/GUI)
* **GUI 框架：** 考慮以下選項：
    * **PyQt/PySide：** 功能強大，UI 設計靈活，但可能較為複雜。
    * **Tkinter：** Python 內建，輕量級，適合簡單介面。
    * **Streamlit/Dash：** 若未來考慮基於 Web 的 GUI，這些框架能快速建立數據應用。
    * **建議：** 考量到未來模組化與簡潔性，以及跨平台需求，初步建議使用 **PyQt5** 或 **PySide6**，它們能夠提供豐富的 UI 組件和良好的擴展性。
* **圖形化：** 使用 `Matplotlib` 或 `Plotly` 等庫進行數據圖形化。

### 3.3 專案管理
* **虛擬環境：** 統一使用 **UV** 進行 Python 虛擬環境管理。
* **依賴管理：** `requirements.txt` 或 `pyproject.toml` (poetry/pdm)。

## 4. 模組化設計

專案應分為以下核心模組，以確保高度的模組化和可重複使用性：

*   `pm2_manager.py`: 負責與 PM2 進行交互的核心邏輯，提供啟動、停止、重啟、獲取列表、獲取詳細資訊等函數。
*   `data_parser.py`: 負責解析 PM2 返回的原始數據 (JSON) 並轉換為易於處理的 Python 物件。
*   `gui_components.py`: 包含可重複使用的 GUI 組件，例如 API 狀態燈、數據圖表組件等。
*   `main_app.py`: 整合 `pm2_manager` 和 `gui_components`，構建主應用程式介面。
*   `config.py`: 存放專案配置，例如 PM2 路徑 (若非全局安裝)。

## 5. 專案結構

```
API_Manager/
├── docs/
│   └── PM2_API_Manager_Plan.md
├── src/
│   ├── __init__.py
│   ├── pm2_manager.py
│   ├── data_parser.py
│   ├── gui_components.py
│   ├── main_app.py
│   └── config.py
├── tests/
│   ├── __init__.py
│   └── test_pm2_manager.py
├── .gitignore
├── README.md
├── requirements.txt
└── pyproject.toml (若使用 Poetry/PDM)
```

## 6. 開發步驟 (高階)

1.  **環境設定：** 建立 Python 虛擬環境 (UV)。
2.  **PM2 交互：** 開發 `pm2_manager.py` 模組，實現與 PM2 的基本交互。
3.  **數據解析：** 開發 `data_parser.py` 模組，處理 PM2 數據。
4.  **基礎 GUI：** 搭建主介面框架，顯示 API 列表。
5.  **狀態顯示：** 實現 API 狀態燈功能。
6.  **詳細資訊與圖形化：** 實現點擊查看詳細資訊和數據圖形化。
7.  **控制功能：** 實現單獨 API 和專案層級的控制功能。
8.  **測試：** 編寫單元測試和整合測試，確保功能穩定。
9.  **文件：** 更新 `README.md`，提供使用說明和開發指南。

## 7. 注意事項

*   **錯誤處理：** 妥善處理 PM2 命令執行失敗、PM2 未安裝等情況。
*   **性能考量：** 若 API 數量較多，需考慮介面響應速度和數據加載效率。
*   **安全性：** 在執行 PM2 命令時，確保沒有安全漏洞。
*   **未來擴展：** 設計時考慮到未來可能增加的其他功能，例如日誌查看器、遠程管理等。
*   **PM2 路徑：** 考慮 PM2 可能不在系統 PATH 中，需要提供配置選項。

本規劃書將作為後續開發的指導文件。 